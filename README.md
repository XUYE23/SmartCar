# SmartCar




## 摘要

本项目旨在为A型无人车构建一套完整、高效的物资保障路径规划与物流网络仿真系统。面对复杂地形、车辆性能约束以及动态的保障需求，我们采用了一系列先进的数学建模方法与算法，实现了从单路径性能评估、合规性校验到大规模、多周期物流网络优化的全链路解决方案。

项目成果包括一个通用的**加权A\***路径规划引擎、一个基于**启发式**的LRP（选址-路径问题）求解器，以及一个基于**滚动时域规划**的15天动态**库存-路径仿真系统**。模型在保证解的质量与可行性的前提下，注重计算效率，能够在有限时间内为复杂的决策问题提供高质量的解决方案。

## 项目结构与运行指南

### 文件结构

```
.
├── map.tif                             # 原始高程地图
├── 附件4：不良区域位置信息.xlsx
├── 附件5：P1-P2的行驶路径.xlsx
├── 附件6：P3-P4的行驶路径.xlsx
├── 附件7：P5-P6行驶路径.xlsx
├── config.py                           # 全局配置文件（路径、常量）
├── utils.py                            # 共享工具函数
├── 01_preprocess.py                    # 步骤一：地形数据预处理
├── 02_solve_problem_1.py               # 步骤二：问题一求解（路径评估）
├── 03_solve_problem_2.py               # 步骤三：问题二求解（合规性校验）
├── 04_solve_problem_3.py               # 步骤四：问题三求解（朝向优化-DP）
├── 05_solve_problem_4.py               # 步骤五：问题四求解（最优路径规划-A*）
├── 06_solve_problem_5.py               # 步骤六：问题五求解（物流网络规划-LRP）
└── 07_solve_problem_6.py               # 步骤七：问题六求解（15天动态仿真-IRP）
```

### 运行顺序

请严格按照脚本编号顺序执行，因为后续脚本依赖于前面脚本的产出。

1.  `python 01_preprocess.py`: 计算并生成`preprocessed_data.npz`。
2.  `python 02_solve_problem_1.py`: 解决问题一。
3.  `python 03_solve_problem_2.py`: 解决问题二。
4.  `python 04_solve_problem_3.py`: 解决问题三。
5.  `python 05_solve_problem_4.py`: 解决问题四，生成三条最优路径的Excel文件。
6.  `python 06_solve_problem_5.py`: 解决问题五。**首次运行会耗时较长（约10-20分钟）**，因为它需要计算并缓存`p5_cost_matrix.json`。后续运行会很快。
7.  `python 07_solve_problem_6.py`: 解决问题六，生成最终的15天运行日志`problem6_vehicle_log.xlsx`。

---

## 各问题模型与方法论

### **核心公共模块 (已完成并验证)**

*   **地形预处理 (`01_preprocess.py`)**: 这是整个项目的数据基石。通过一次性遍历地图，计算并缓存所有栅格的坡度、坡向、法向量等高频使用属性，极大地提升了后续所有路径规划算法的运行效率。

### **问题一至三：基础路径分析 (已完成并验证)**

*   **问题一 (路径评估)**: 采用**序列迭代模拟器**，逐点累加计算给定路径的四项性能指标（里程、时效、平稳、安全）。
*   **问题二 (合规性校验)**: 采用**规则驱动的序列校验器**，逐点检查坡度是否超限，并根据精确的转向逻辑查找表验证相邻状态转移的合法性。
*   **问题三 (朝向优化)**: 采用**动态规划 (Dynamic Programming)** 算法，建立了类似维特比算法的状态转移模型，在给定路径点序列上，求解出了使得总里程最小的最优朝向序列，保证了全局最优解。

### **问题四：最优路径规划 (已完成并验证)**

*   **模型思想**: 将问题抽象为大规模图搜索问题。节点（状态）定义为 `(x, y, heading)`，以包含转向成本。
*   **核心算法**: 构建了一个通用的**A\* (A-Star) 搜索算法框架**。相比于Dijkstra，A\*通过引入启发函数，能够进行目标导向的“智能”搜索，在保证解的最优性（或接近最优）的同时，大幅提升计算效率。
*   **创新与优化**:
    *   **加权A\* (Weighted A\*)**: 针对计算耗时过长的问题，我们引入了加权A\*，通过为启发函数设置权重 `W > 1` (如 `W=3.0`)，在牺牲可控的、极小的最优性代价下，将计算时间缩短了数个数量级（从数小时到数分钟），体现了在解决复杂工程问题时，在效率和最优性之间进行科学权衡的建模思想。
    *   **通用成本函数**: 通过为A\*框架传入不同的成本函数（平稳性、时间、里程）和相应的启发函数，用一套统一的模型解决了三个不同的优化问题。

### **问题五：一次性物资保障网络规划 (已完成并验证)**

*   **模型思想**: 将问题建模为经典的**选址-路径问题 (Location-Routing Problem, LRP)**，并创新性地加入了**电量约束**，使其升级为更具挑战性的**LRP-EV**模型。
*   **核心算法**: 采用分阶段启发式方法求解：
    1.  **阶段一 (成本预计算)**: 调用问题四的A\*引擎，计算所有关键点对（C-Z, Z-Z）之间的最优时间路径及其电量消耗，并缓存为成本矩阵 `p5_cost_matrix.json`。
    2.  **阶段二 (选址与分配)**: 设计了一个鲁棒的**“成本优先”分配算法**。该算法首先过滤掉所有物理上或电量上不可行的“仓库-阵地”服务选项，然后根据时间成本对所有可行选项进行排序，贪心式地将阵地分配给成本最低且有余量的仓库。此方法有效避免了仓库超载和分配不可达客户的问题。
    3.  **阶段三 (车辆路径规划)**: 对每个启用的仓库，先进行**订单拆分 (Order Splitting)** 以处理超出单车容量的大额需求，然后应用经典的**Clarke-Wright节省算法**，并在其合并规则中加入了严格的**往返电量检查**，确保所有生成的路线都满足续航约束。
*   **关键发现**: 模型正确地揭示了在当前约束下，Z1, Z5, Z8三个阵地因距离过远或地形复杂，无法由任何单个仓库在一次往返、电量充足的情况下完成服务。这不仅是计算结果，更是对任务本身内在物理约束的深刻洞察。

### **问题六：15天连续保障与充电调度 (已完成并验证)**

*   **模型思想**: 将问题建模为带有充电约束的**库存-路径问题 (E-IRP)**。由于其高度的动态性和复杂性，我们采用了业界前沿的**基于仿真的滚动时域规划 (Rolling Horizon Planning based on Simulation)** 方法。
*   **核心算法**:
    1.  **仿真循环**: 构建一个以“天”为单位的15天主循环，模拟时间的流逝。
    2.  **状态管理**: 设计了一个`SystemState`类，实时追踪所有实体（阵地库存、车辆位置、电量、状态等）的动态变化。
    3.  **每日动态决策**: 在每一天的开始，模型会：
        a. 根据**库存阈值策略**（低于0.5天补给，补至3.5天）动态生成当日的补货需求。
        b. 采用**贪心调度启发式算法**，为当日需求指派最佳的空闲车辆（综合考虑位置和当前电量），并生成简单的“仓库-阵地-仓库”往返任务。
    4.  **离散事件仿真**: 采用一个基于**优先队列**的事件调度器，按时间顺序精确模拟一天内发生的所有事件，如`DEPART`, `ARRIVE_FRONT`, `ARRIVE_WAREHOUSE`, `START_CHARGE`, `END_CHARGE`。
    5.  **充电模型**: 精确实现了2小时为单位的阶梯式充电规则和每个仓库最多2个充电桩的资源约束。
*   **最终产出**: 模型最终生成了一份完全符合题干要求的、详细的15天运行日志Excel文件，并汇总了**启用仓库数**、**投入车辆数**和**总运输趟次**这三项核心优化指标，为整个保障任务提供了全面、可执行的行动方案和性能评估。

---
